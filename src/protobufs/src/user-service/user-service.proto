syntax = "proto3";
package service.user;

option go_package = "generated/user-protobuf";

service UserService {
  rpc CreateUser(CreateUserRequest) returns (User);
  rpc GetUserById(GetUserByIdRequest) returns (User);
  rpc RefreshToken(RefreshTokenRequest) returns (Session);
  rpc RequestAuthentication(RequestAuthenticationRequest) returns (Empty);
  rpc AuthenticateWithOTP(OTPAuthenticationRequest) returns (Session);
  rpc GetActiveSessions(GetActiveSessionsRequest) returns (GetActiveSessionsResponse);
  rpc InvalidateSession(InvalidateSessionRequest) returns (Empty);
  rpc GetUserByPhoneNumber(GetUserByPhoneNumberRequest) returns (User);
  rpc GetUserTransfers(GetUserTransfersRequest) returns (GetUserTransfersResponse);
}

message GetUserTransfersRequest {
  string          user_id       = 1;
  optional string min_timestamp = 2;
  optional string max_timestamp = 3;
  optional uint32 limit         = 4;
}

message GetUserTransfersResponse {
  repeated Transfer transfers = 1;
}

message Transfer {
  string transfer_id            = 1;
  string debit_account_id       = 2;
  string credit_account_id      = 3;
  string amount                 = 4;
  string debit_user_full_name   = 5;
  string credit_user_full_name  = 6;
  string timestamp              = 7;
  bool   is_system_transfer     = 8;
  bool   is_increasing_transfer = 9;
  bool   pending                = 10;
  bool   posted                 = 11;
  bool   voided                 = 12;

}

message GetUserByPhoneNumberRequest {
  string phone_number = 1;
}

message Empty {}

message InvalidateSessionRequest {
  string session_id = 1;
  string user_id    = 2;
}

message GetActiveSessionsRequest {
  string user_id = 1;
}

message ActiveSession {
  string session_id  = 1;
  string expires     = 2;
  string created_at  = 3;
  string device      = 4;
  string application = 5;
  string ip_address  = 6;
}

message GetActiveSessionsResponse {
  repeated ActiveSession sessions = 1;
}

message GetUserByIdRequest {
  string user_id = 1;
}

message RequestAuthenticationRequest {
  string phone_number = 1;
}

message RefreshTokenRequest {
  string refresh_token = 1;
}

message OTPAuthenticationRequest {
  string phone_number = 1;
  string code         = 2;
  string device       = 3;
  string application  = 4;
  string ip_address   = 5;
}

message CreateUserRequest {
  string phone_number = 1;
  string first_name   = 2;
  string last_name    = 3;
  string address      = 4;
  string birth_date   = 5;
}

message User {
  string user_id         = 1;
  string phone_number    = 2;
  string first_name      = 3;
  string last_name       = 4;
  string address         = 5;
  string created_at      = 6;
  string birth_date      = 7;
  string balance         = 8;
  string pending_debits  = 9;
  string pending_credits = 10;
}

message Session {
  string access_token          = 1;
  string refresh_token         = 2;
  string access_token_expires  = 3;
  string refresh_token_expires = 4;
}
